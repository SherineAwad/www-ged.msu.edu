<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.4: http://docutils.sourceforge.net/" />
<title>Lab 9 Material / October 23rd, 2008</title>
<style type="text/css">

/*
:Author: David Goodger
:Contact: goodger@users.sourceforge.net
:Date: $Date: 2005-12-18 01:56:14 +0100 (Sun, 18 Dec 2005) $
:Revision: $Revision: 4224 $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin-left: 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left {
  clear: left }

img.align-right {
  clear: right }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font-family: serif ;
  font-size: 100% }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em ;
  background-color: #eeeeee }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

tt.docutils {
  background-color: #eeeeee }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="lab-9-material-october-23rd-2008">
<h1 class="title">Lab 9 Material / October 23rd, 2008</h1>
<p>Running tests is good.  Making tests easier to run is better.  Better test
reporting is even better.</p>
<div class="section">
<h1><a id="preparation" name="preparation">Preparation</a></h1>
<p>Today is going to be about <em>tools</em> -- I want to give you the tools to
do better and more convenient testing.</p>
<p>We'll be doing everything on arctic today, because that's where I've
installed all the necessary software.  Talk to me if you need help
installing any of these tools for your own work environment; they're
all open source and freely available.</p>
<p>Start by loading in my environment:</p>
<pre class="literal-block">
source ~ctb/python-env.csh
</pre>
<p>and checking out the lab-9 materials:</p>
<pre class="literal-block">
svn co http://class.ged.idyll.org/svn/files/lab-9/
</pre>
<p>(This may take a while; you can also do:</p>
<blockquote>
cp -r ~ctb/lab-9 lab-9</blockquote>
<p>if you want)</p>
<p>OK, now you should be set!</p>
</div>
<div class="section">
<h1><a id="using-nose-to-run-tests" name="using-nose-to-run-tests">Using nose to run tests</a></h1>
<p>'nose' is an add-on package for Python that lets you run unit tests
more nicely.  Try:</p>
<pre class="literal-block">
% nosetests webserve-test.py
...........................
----------------------------------------------------------------------
Ran 27 tests in 0.023s

OK
</pre>
<p>in your homework8 directory (or equivalently in the lab-9/ directory).</p>
<p>You can get more verbose output like so:</p>
<pre class="literal-block">
% nosetests -v webserve-test.py
Check that URLs not explicitly handled return 404s. ... ok
test_add_user (webserve-test.CheckAddUser) ... ok
GET / ==&gt; files/index.html ... ok
...
</pre>
<p>This prints out the information from each test's docstring.</p>
<p>So, why is nose an improvement over unittest?  There are a bunch of reasons,
but two of the most important are that it <strong>captures output</strong> and
it lets you <strong>selectively run tests</strong>.</p>
<div class="section">
<h2><a id="capturing-output" name="capturing-output">Capturing output</a></h2>
<p>What do I mean by capturing output?</p>
<p>Go into the lab-9/ directory and run:</p>
<pre class="literal-block">
% python simple-test.py
foo
bar
Ffib
faz
.
======================================================================
FAIL: test_error (__main__.SimpleTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;simple-test.py&quot;, line 8, in test_error
    assert False, &quot;this test fails&quot;
AssertionError: this test fails
----------------------------------------------------------------------
Ran 2 tests in 0.000s

FAILED (failures=1)
</pre>
<p>If you look at the simple-test.py file, you'll see that the print
statements in each test function are all printed out before any
errors, which makes it difficult to figure out what print statements
are associated with what tests.</p>
<p>Now try:</p>
<pre class="literal-block">
% nosetests simple-test.py
F.
======================================================================
FAIL: test_error (simple-test.SimpleTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;/Users/t/Desktop/teaching/week9/lab/simple-test.py&quot;, line 8, in test_error
    assert False, &quot;this test fails&quot;
AssertionError: this test fails
-------------------- &gt;&gt; begin captured stdout &lt;&lt; ---------------------
foo
bar

--------------------- &gt;&gt; end captured stdout &lt;&lt; ----------------------

----------------------------------------------------------------------
Ran 2 tests in 0.001s

FAILED (failures=1)
</pre>
<p>Here, 'nose' has captured the test print output for each test and
either hidden it (for the successful test) or printed it out along
with the test error.</p>
<p>This simple change lets you put as many print statements into your
test code as you want, without contaminating the output when your
tests are successful; and it lets you see <em>exactly</em> what print statements
are executed for failing tests.</p>
</div>
<div class="section">
<h2><a id="selectively-running-tests" name="selectively-running-tests">Selectively running tests</a></h2>
<p>Another major convenience of nose is that it will let you pick out and
selectively run tests.  For example,
nose will let you run precisely one test.  Try:</p>
<pre class="literal-block">
% nosetests webserve-test.py:TestDelegate.test_1
.
----------------------------------------------------------------------
Ran 1 test in 0.013s

OK
</pre>
<p>This runs the 'test_1' function on the 'TestDelegate' class in the
file 'webserve-test.py'.</p>
</div>
</div>
<div class="section">
<h1><a id="testing-with-twill" name="testing-with-twill">Testing with twill</a></h1>
<p>twill (<a class="reference" href="http://twill.idyll.org/">http://twill.idyll.org/</a>) is another useful testing tool.  It's
an <strong>HTTP driver</strong> that lets you script Web page actions through either
a simple command language or through Python directly.  This lets you
do more <em>functional</em> testing -- testing from socket connections all
the way through to your database code -- than the unit tests let you do.</p>
<p>Let's start by looking at a simple twill script for testing our login site.
You can look at it here:</p>
<blockquote>
<a class="reference" href="http://class.ged.idyll.org/svn/files/lab-9/test-login.twill">http://class.ged.idyll.org/svn/files/lab-9/test-login.twill</a></blockquote>
<p>and it should be in your lab-9/ subdirectory.</p>
<p>This script starts by going to the login form, fills it in with
test/test, submits it, and checks to make sure that login worked
properly.  Then it goes and does a bunch of other stuff, basically
duplicating some of the unit tests that I gave you.</p>
<p>Try it out; to run it against my example server, do:</p>
<pre class="literal-block">
% twill-sh -u http://class.ged.idyll.org:8080/ test-login.twill
</pre>
<p>(You can also run it against your own server by putting that URL in.)</p>
<p>The difference between this and the unit tests is that this is
checking to make sure your entire server-side software stack -- HTTP
and socket handling included -- work properly.  Unlike the unit tests,
twill tests can figure out if your HTTP is malformed, or not being
sent right to the socket, or whatnot.</p>
<p>The tradeoff is that you lose granularity: you can't test functions in
isolation with twill.  So, if you mess up your handle_connection
function, for example, all of the tests will fail - even if your delegate
function is still working properly.</p>
</div>
<div class="section">
<h1><a id="twill-from-python" name="twill-from-python">twill from Python</a></h1>
<p>twill is written in Python, and so you can run the twill commands
directly from Python. (You can also extend twill with Python functions,
which we probably won't do in this class.)</p>
<p>I've translated the top part of the test-login.twill script into Python;
take a look at it here:</p>
<blockquote>
<a class="reference" href="http://class.ged.idyll.org/svn/files/lab-9/test-login-with-twill.py">http://class.ged.idyll.org/svn/files/lab-9/test-login-with-twill.py</a></blockquote>
<p>You can run it against a Web site by typing</p>
<pre class="literal-block">
python test-login-with-twill http://class.ged.idyll.org:8080/
</pre>
<p>Generally I would recommend using the twill script for testing
purposes; that way you won't have to debug your test scripts.  But you
can do all sorts of things with twill, Python, and other Web sites...</p>
</div>
<div class="section">
<h1><a id="testing-with-selenium" name="testing-with-selenium">Testing with Selenium</a></h1>
<p>OK, the last set of neat testing technology we'll explore is Selenium Core,
a browser-based JavaScript library that lets you drive your Web application
from within your Web application.</p>
<p>Confused?</p>
<p>Go here:</p>
<blockquote>
<a class="reference" href="http://class.ged.idyll.org:8080/">http://class.ged.idyll.org:8080/</a></blockquote>
<p>and click on &quot;Visit the Selenium tests under tests/&quot;.</p>
<p>Click on &quot;Introductory Selenium test suite&quot;.</p>
<p>You should see a list of test suites on the upper left, and a control
panel on the upper right.  Adjust the speed to &quot;slow&quot; and hit the
green &quot;play&quot; button (leftmost).</p>
<p>Selenium will now run through the given test suite, running the tests
(specified in HTML tables) one by one in sequence.</p>
<p>Pretty cool, eh?</p>
<p>What's really going on here?!  Well, Selenium is a JavaScript library
that reads test commands specified in HTML tables and runs them; these
commands can include things like &quot;go to this page&quot; and &quot;fill out this
form this way&quot;.  The neat thing is that it actually uses your browser
to do it, so you can run the same tests in Firefox, IE, Safari, etc. --
any browser that supports JavaScript.</p>
<p>(And, as you'll see later, Selenium is one of the few ways you can
actually <em>test</em> the interaction of browser-side JavaScript with the
Web server, e.g. testing of AJAX code...)</p>
<p>How is this encoded?  Well, briefly, if you look under</p>
<blockquote>
<a class="reference" href="http://class.ged.idyll.org/svn/files/lab-9/files/tests/">http://class.ged.idyll.org/svn/files/lab-9/files/tests/</a></blockquote>
<p>you can see the list of test suites in index.html,</p>
<blockquote>
<a class="reference" href="http://class.ged.idyll.org/svn/files/lab-9/files/tests/index.html">http://class.ged.idyll.org/svn/files/lab-9/files/tests/index.html</a></blockquote>
<p>the test suite being run under</p>
<blockquote>
<a class="reference" href="http://class.ged.idyll.org/svn/files/lab-9/files/tests/suite.html">http://class.ged.idyll.org/svn/files/lab-9/files/tests/suite.html</a></blockquote>
<p>and an example test here:</p>
<blockquote>
<a class="reference" href="http://class.ged.idyll.org/svn/files/lab-9/files/tests/SimpleLoginTests.html">http://class.ged.idyll.org/svn/files/lab-9/files/tests/SimpleLoginTests.html</a></blockquote>
<p>The only tricky stuff is in the last file, which contains a list of
<strong>commands</strong> ('open', 'type', etc.) and arguments to those commands.
The actual commands should be pretty straightforward to understand.</p>
</div>
<div class="section">
<h1><a id="conclusion" name="conclusion">Conclusion</a></h1>
<p>Unit tests, and the nose tool, and twill, and Selenium, are all tools
to <em>help you test</em> by making it easy to write, organize, and run your
tests.  You don't necessarily have to use them (although I will ask
you to write twill and Selenium tests) but they can really help speed
up your development work.  Moreover, they make it relatively easy to
test things like Web servers, and (even better) twill and Selenium are
language-independent -- they can be used to test <em>any</em> Web server.</p>
</div>
</div>
</body>
</html>
