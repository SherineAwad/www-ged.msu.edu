<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.4: http://docutils.sourceforge.net/" />
<title>Lab 2 Material / September 4th, 2008</title>
<style type="text/css">

/*
:Author: David Goodger
:Contact: goodger@users.sourceforge.net
:Date: $Date: 2005-12-18 01:56:14 +0100 (Sun, 18 Dec 2005) $
:Revision: $Revision: 4224 $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin-left: 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left {
  clear: left }

img.align-right {
  clear: right }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font-family: serif ;
  font-size: 100% }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em ;
  background-color: #eeeeee }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

tt.docutils {
  background-color: #eeeeee }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="lab-2-material-september-4th-2008">
<h1 class="title">Lab 2 Material / September 4th, 2008</h1>
<div class="section">
<h1><a id="short-note-on-homework-associated-tests" name="short-note-on-homework-associated-tests">Short note on homework &amp; associated tests</a></h1>
<p>Eternal optimism is good, but if another person comes up to me and says</p>
<pre class="literal-block">
assert list(x) == list(x)
</pre>
<p>is failing!! but it shouldn't! My code works! I will (metaphorically)
slap them silly if they <strong>haven't</strong> broken the code down like this:</p>
<pre class="literal-block">
a = list(x)
print a
b = list(x)
print b
assert a == b
</pre>
<p>Just a warning.</p>
</div>
<div class="section">
<h1><a id="handing-in-your-homework" name="handing-in-your-homework">Handing in your homework</a></h1>
<p>You'll be using Subversion to hand in your homework.</p>
<p>For homework #1, this involves:</p>
<blockquote>
<ul>
<li><p class="first">checking out a (blank!) working copy of your subversion repository:</p>
<blockquote>
<p><tt class="docutils literal"><span class="pre">http://class.ged.idyll.org/svn/&lt;username&gt;</span></tt></p>
</blockquote>
</li>
<li><p class="first">creating a directory 'homework1' in your working copy</p>
</li>
<li><p class="first">adding that directory to the list of files to commit</p>
</li>
<li><p class="first">putting your code in a file named 'homework1.py', in that directory</p>
</li>
<li><p class="first">adding the file to the list of files to commit</p>
</li>
<li><p class="first">committing your changes</p>
</li>
</ul>
</blockquote>
<p>Under UNIX, here are the commands:</p>
<pre class="literal-block">
% svn checkout http://class.ged.idyll.org/svn/&lt;username&gt;
% cd &lt;username&gt;
% mkdir homework1
% svn add homework1
% cd homework1
% cp /some/other/path/homework-file ./homework-1.py
% svn add homework-1.py
% svn commit -m &quot;my first homework&quot;
</pre>
<p>(If you have a different SVN username than your login account, you may
need to specify 'svn checkout --username &lt;username&gt; ...'.)</p>
<p>Under Windows, you can use <a class="reference" href="http://tortoisesvn.tigris.org/">TortoiseSVN</a> (installed on all the lab Windows
machines) to do this with a GUI; we can run through it in class.</p>
<p>Once you've done the commit, <strong>check out a new copy</strong> and make sure
that the file is there and correct.  (You can also browse your
repository online, at the same URL.)  A convenient way to do this checkout
under UNIX is</p>
<pre class="literal-block">
svn checkout http://class.ged.idyll.org/svn/&lt;username&gt; TEST
</pre>
<p>This puts the new 'working copy' in the 'TEST/' directory.</p>
<p>For homework2, just put all the files in the 'homework2/' top-level
subversion directory, with filenames as given in the homework handout.</p>
<p>For office hours and e-mailing me questions, you can use subversion
('svn' for short) to send me the files you want to ask me about: check
in whatever you're working on and tell me the URL, e.g.</p>
<blockquote>
<a class="reference" href="http://class.ged.idyll.org/svn">http://class.ged.idyll.org/svn</a>/&lt;username&gt;/homework1/homework1.py</blockquote>
<p>For those who want to use git, please just start by using subversion
to hand in the homework.  I'll set up git repos soon, sorry :).</p>
</div>
<div class="section">
<h1><a id="homework-review" name="homework-review">Homework review</a></h1>
<p>We'll do a brief homework review on Tuesday in class, once I've had a
chance to look at your homework and send you suggestions for
changes/fixes.  (I'll try to do that by Friday evening.)</p>
</div>
<div class="section">
<h1><a id="scripts-vs-importable-files" name="scripts-vs-importable-files">Scripts vs importable files</a></h1>
<p>First, see the Wiki page <a class="reference" href="http://msu-cse491-fall-2008.wikidot.com/creatingandrunningpythonscripts">Creating and running Python scripts</a> for basic info.</p>
<p><em>Scripts</em> are Python files that do something more than just define
stuff -- they contain execution instructions.  E.g.,</p>
<pre class="literal-block">
script.py:
  print 'hello, world'
</pre>
<p>The name of a script file can be anything that's a valid filename.  On
UNIX, this is anything that doesn't contain a forward slash ('/').  On
Windows, it's something similar.  In general I suggest making things
cross-OS-friendly and typing-friendly, e.g. no spaces, backslashes, or
funny characters; 'my-favorite-script-name' is fine.  There's no requirement
that the filename end in '.py' although if it does than various operating
systems may let you double-click on it to run it.</p>
<p>A neat UNIX/Mac OS X trick is to put this magic code:</p>
<pre class="literal-block">
#! /usr/bin/env python2.5
</pre>
<p>at the top of your script file, and then do 'chmod +x scriptfile'.  This
will make it a shell-executable script than be run simply by doing</p>
<pre class="literal-block">
./scriptfile
</pre>
<p><em>Modules</em> are importable Python files.  We can talk later about the
precise rules that import uses, but things in the same directory as a
script are generally importable by Python.  However, module files <em>must</em>
end in '.py' and have to be valid Python identifiers, e.g.</p>
<pre class="literal-block">
import modulefile
</pre>
<p>or</p>
<pre class="literal-block">
import module_file
</pre>
<p>will find 'modulefile.py' or 'module_file.py' appropriately, but you can't
do</p>
<pre class="literal-block">
import module-file
</pre>
<p>to get 'module-file.py' because that's not a legal Python name ('-' isn't
allowed in variable names.)</p>
<p>Generally I recommend writing modules so that they are both modules <em>and</em>
scripts; the scripts do some basic testing of the code in the module.  So,
for example,</p>
<pre class="literal-block">
hello.py:
 def hello(world):
   return 'hello ' + world

 assert hello('world') == 'hello world'
</pre>
<p>will define 'hello' and also run a test on it: it can be imported as a module,</p>
<pre class="literal-block">
import hello
print hello.hello('steve')
</pre>
<p>or run as a script:</p>
<pre class="literal-block">
% python hello.py
</pre>
<p>You may not always want stuff to be run on import, especially if you
have time-consuming tests, so you can use this trick (documented on the
Wiki page, too) to differentiate between code that should be executed on
import vs on command-line execution:</p>
<pre class="literal-block">
hello.py:
 def hello(world):
    return 'hello ' + world

 if __name__ == '__main__':
    assert hello('eva') == 'hello eva'
</pre>
<p>The 'assert' command will only be run when the file is executed as a script
by doing</p>
<pre class="literal-block">
python hello.py
</pre>
<p>This kind of thing is really convenient when you're writing and
testing code: put your test code at the bottom of the file and then
just run the module every time you make a change (F5 in IDLE).</p>
<p>To recap, here's my recommended format for Python modules:</p>
<pre class="literal-block">
module.py:
  #! /usr/bin/env python2.5

  # ... define functions/classes/etc. ...

  if __name__ == '__main__':
     # ... define tests of functions/classes etc ...
     #
     #   OR
     #
     # ... define script-like behavior ...
</pre>
</div>
<div class="section">
<h1><a id="two-more-command-line-thoughts" name="two-more-command-line-thoughts">Two more command-line thoughts</a></h1>
<p>If you use the '-i' flag to the Python interpreter when running a
script, you'll be left at the Python prompt after the script runs:</p>
<pre class="literal-block">
% python -i scriptfile
... scriptfile runs ...
&gt;&gt;&gt;
</pre>
<p>This Python prompt will have all your functions defined for interactive
testing, etc.  Very useful.</p>
<p>If you want to write an actual script that takes in arguments, use
'sys.argv'.  It is a list of all of the arguments to your script:</p>
<pre class="literal-block">
scriptfile.py:
  print sys.argv
</pre>
<p>so that</p>
<pre class="literal-block">
% python scriptfile.py arg1 arg2 arg3 arg4
</pre>
<p>will print out</p>
<pre class="literal-block">
scriptfile.py arg1 arg2 arg3 arg4
</pre>
<p>You'll need this for the homework.</p>
</div>
<div class="section">
<h1><a id="tcp-ip-socket-stuff" name="tcp-ip-socket-stuff">TCP/IP socket stuff</a></h1>
<div class="section">
<h2><a id="connecting-out" name="connecting-out">Connecting out</a></h2>
<p>Creating a socket:</p>
<pre class="literal-block">
import
sock = socket.socket()
</pre>
<p>Connecting that socket to a remote server:</p>
<pre class="literal-block">
remote_address = 'teckla.idyll.org'
port = 25
sock.connect((remote_address, port))
</pre>
<p>Reading from the socket:</p>
<pre class="literal-block">
data = sock.recv(4096)
</pre>
<p>You will get <em>up to</em> bufsize=4096 bytes, and if there is nothing
available, 'sock.recv' will block (wait) until either there <em>is</em> something
available, or the socket closes, or you hit CTRL-C.</p>
<p>Writing to the socket:</p>
<pre class="literal-block">
data = sock.sendall('HELO foo.msu.edu')
</pre>
<p>Here's a sample SMTP (mail) session:</p>
<pre class="literal-block">
&gt;&gt;&gt; import socket
&gt;&gt;&gt; sock = socket.socket()
</pre>
<p>Connect to the server:</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; sock.connect(('teckla.idyll.org', 25))
&gt;&gt;&gt; sock.recv(4096)                   #doctest: +ELLIPSIS
'220 teckla.idyll.org ESMTP Exim 4.63 ...\r\n'
</pre>
</blockquote>
<p>Say hello:</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; sock.sendall(&quot;HELO foo.msu.edu\n&quot;)
&gt;&gt;&gt; sock.recv(4096)                   #doctest: +ELLIPSIS
'250 teckla.idyll.org Hello ....msu.edu [...]\r\n'
</pre>
</blockquote>
<p>Identify the sender address:</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; sock.sendall(&quot;MAIL FROM: t&#64;foo.msu.edu\n&quot;)
&gt;&gt;&gt; sock.recv(4096)
'250 OK\r\n'
</pre>
</blockquote>
<p>Identify the recipient address:</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; sock.sendall(&quot;RCPT TO: null&#64;idyll.org\n&quot;)
&gt;&gt;&gt; sock.recv(4096)
'250 Accepted\r\n'
</pre>
</blockquote>
<p>OK, greetings are over; set up to send the actual message:</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; sock.sendall('DATA\n')
&gt;&gt;&gt; sock.recv(4096)
'354 Enter message, ending with &quot;.&quot; on a line by itself\r\n'
</pre>
</blockquote>
<p>Aaaaaaaaaaaaand send!</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; sock.sendall('foo bar baz\n.\n')
&gt;&gt;&gt; sock.recv(4096)       #doctest: +ELLIPSIS
'250 OK...\r\n'
</pre>
</blockquote>
<p>Be nice &amp; 'quit' before closing.</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; sock.sendall('quit\n')
&gt;&gt;&gt; sock.close()
</pre>
</blockquote>
</div>
<div class="section">
<h2><a id="allowing-connections-in" name="allowing-connections-in">Allowing connections in</a></h2>
<p>Create a socket:</p>
<pre class="literal-block">
import socket
sock = socket.socket()
</pre>
<p>If 'interface' is a blank string, connections are allowed in to all
IP addresses on this host; if it's non-blank, e.g. e.g. '127.0.0.1',
then only connections to that network interface are allowed.</p>
<pre class="literal-block">
interface = ''
port = 5555

sock.bind( (interface, port) )
</pre>
<p>Allow up to 5 &quot;backlogged&quot; connections:</p>
<pre class="literal-block">
sock.listen(5)
</pre>
<p>Handle incoming connections until they die:</p>
<pre class="literal-block">
while 1:
   (client_sock, client_address) = sock.accept()

    while 1:
        data = client_sock.recv(4096)
        if not data:
            break

        print 'got data:', data
</pre>
<p>For example, if you run this in IDLE, you can try using your Web browser to
connect to</p>
<blockquote>
<a class="reference" href="http://localhost:5555/">http://localhost:5555/</a></blockquote>
<p>to see what's printed out on your screen by both sides...</p>
<p>Two final notes -- 'bind' is sometimes a bit sticky, and you may have to
wait for a while (10-20 seconds) before rebinding a socket after hitting
CTRL-C.  One way around this is just to change the port number.</p>
<p>Also, if you can find a 'telnet' program (installed on many UNIXes by
default; not available on Windows by default -- enable <a class="reference" href="http://windowsitpro.com/article/articleid/93952/where-is-the-telnet-client-in-windows-vista.html">like this</a>) then you can talk directly to TCP ports; just do</p>
<pre class="literal-block">
telnet teckla.idyll.org 25
</pre>
<p>to connect to port 25 on teckla.idyll.org...</p>
</div>
</div>
</div>
</body>
</html>
